<html lang="es">
<head>
<meta charset="UTF-8">
<title>FIRO NODE TERMINAL</title>
<style>
body { background: #000; color: #fff; font-family: "Lucida Console", monospace; padding: 20px; }
.terminal { max-width: 80ch; white-space: pre-wrap; }
.footer {
  margin-top:auto;
  padding:20px 0;
  color:#aaa;
}
</style>
</head>
<body>
<div class="terminal" id="terminal">
FIRO NODE TERMINAL
==================
Cargando...
</div>
<div class="footer">--------------------------------------------------------------------------<br>© 2026 Creada con ♥ por cΔrovΣr0 | apoya: carover0.firo</div>

<script>
function loadData() {
    const terminal = document.getElementById('terminal');
    terminal.innerHTML = `FIRO NODE TERMINAL
==================
Cargando usando JSONP...`;

    // Limpiar script anterior
    const oldScript = document.getElementById('jsonp-script');
    if (oldScript) oldScript.remove();

    // Crear nuevo script con JSONP
    const script = document.createElement('script');
    script.id = 'jsonp-script';
    
    const JSON_URL = "https://carover0.xyz/api/firo.json";
    // Usamos JSONP con callback
    script.src = `https://whateverorigin.org/get?callback=handleData&url=${encodeURIComponent(JSON_URL)}&_=${Date.now()}`;
    
    script.onerror = () => {
        terminal.innerHTML = `ERROR: No se pudo cargar los datos.\n\nURL: ${script.src}`;
    };
    
    document.body.appendChild(script);
}

// Función global que recibe los datos del JSONP
window.handleData = function(wrapper) {
    const terminal = document.getElementById('terminal');
    try {
        const data = JSON.parse(wrapper.contents);
        
        const uptimeSec = data.node.uptime_seconds;
        const days = Math.floor(uptimeSec / 86400);
        const hours = Math.floor((uptimeSec % 86400) / 3600);
        
        let output = `FIRO NODE TERMINAL
==================

BLOQUE ACTUAL : ${data.blockchain.blocks}
FECHA         : ${data.datetime}
CONEXIONES    : ${data.network.connections}
UPTIME        : ${days}d ${hours}h
TIMESTAMP     : ${data.timestamp} (${new Date(data.timestamp*1000).toLocaleTimeString()})

-----------------------------------------------------------------
ULTIMOS 15 BLOQUES
-----------------------------------------------------------------`;

        data.recent.last_15_blocks.forEach(b => {
            const fecha = new Date(b.time * 1000).toLocaleString();
            const hashMostrado = b.hash.substring(0,18) + '...' + b.hash.slice(-25);
            output += `\n#${String(b.height).padEnd(6)} ${String(b.tx_count).padEnd(3)} ${hashMostrado.padEnd(22)} ${fecha}`;
        });

        output += `\n
-----------------------------------------------------------------
ULTIMAS 15 TRANSACCIONES
-----------------------------------------------------------------`;

        data.recent.last_15_transactions.forEach(t => {
            const valor = t.value_out === null ? "0.0000" : t.value_out.toFixed(4);
            output += `\n${String(t.confirmations).padEnd(3)}  ${valor.padEnd(8)}  ${t.txid}`;
        });

        output += `\n
-----------------------------------------------------------------
MEMPOOL PREVIEW (${data.mempool.txcount} TRANSACCIONES)
-----------------------------------------------------------------`;

        if (data.recent.mempool_preview?.length) {
            data.recent.mempool_preview.forEach(txid => output += `\n${txid.substring(0,40)}`);
        } else {
            output += `\nMempool vacío`;
        }

        output += `\n`;
        terminal.innerHTML = output;
        
    } catch (error) {
        terminal.innerHTML = `ERROR procesando datos: ${error.message}`;
    }
};

loadData();
setInterval(loadData, 10000);
</script>

</body>
</html>
