<html lang="es">
<head>
<meta charset="UTF-8">
<title>FIRO NODE TERMINAL</title>
<style>
body { background: #000; color: #fff; font-family: "Lucida Console", monospace; padding: 20px; }
.terminal { max-width: 80ch; white-space: pre-wrap; }
.footer {
  margin-top:auto;
  padding:20px 0;
  color:#aaa;
}
a, a:visited, a:hover, a:active {
    color: #9B1C2E;
    text-decoration: none; 
}
a:hover {
    text-decoration: underline; 
}

</style>
</head>
<body>
<div class="terminal" id="terminal">
EXPLORADOR DE BLOQUES TERMINAL 
==============================
Cargando...
</div>
<div class="footer">--------------------------------------------------------------------------<br>© 2026 Creada con ♥ por cΔrovΣr0 | apoya: carover0.firo</div>

<script>
function loadData() {
    const terminal = document.getElementById('terminal');
    terminal.innerHTML = `EXPLORADOR DE BLOQUES TERMINAL
==============================
Cargando usando JSONP...`;

    // Limpiar script anterior
    const oldScript = document.getElementById('jsonp-script');
    if (oldScript) oldScript.remove();

    // Crear nuevo script con JSONP
    const script = document.createElement('script');
    script.id = 'jsonp-script';
    
    const JSON_URL = "https://carover0.xyz/api/firo.json";
    // Usamos JSONP con callback
    script.src = `https://whateverorigin.org/get?callback=handleData&url=${encodeURIComponent(JSON_URL)}&_=${Date.now()}`;
    
    script.onerror = () => {
        terminal.innerHTML = `ERROR: No se pudo cargar los datos. Recargar la pagina suele solucionarlo o espera, la pagina se actualiza sola cada 45 seg\n\nURL: ${script.src}`;
    };
    
    document.body.appendChild(script);
}

// Función global que recibe los datos del JSONP
window.handleData = function(wrapper) {
    const terminal = document.getElementById('terminal');
    try {
        const data = JSON.parse(wrapper.contents);
        
        const uptimeSec = data.node.uptime_seconds;
        const days = Math.floor(uptimeSec / 86400);
        const hours = Math.floor((uptimeSec % 86400) / 3600);
        
        let output = `EXPLORADOR
==========

BLOQUE ACTUAL : ${data.blockchain.blocks}
FECHA         : ${data.datetime}
CONEXIONES    : ${data.network.connections}
UPTIME        : ${days}d ${hours}h
TIMESTAMP     : ${data.timestamp} (${new Date(data.timestamp*1000).toLocaleTimeString()})

<a href="https://carover0.github.io/pagina/buscar.html">[BUSCAR]</a> <a href="https://carover0.github.io/pagina/firostats.html">[FIRO]</a>

ULTIMOS 15 BLOQUES
--------------------------------------------------------------------------------
bloque  tx  hash                                            fecha
--------------------------------------------------------------------------------`;

        data.recent.last_15_blocks.forEach(b => {
            const fecha = new Date(b.time * 1000).toLocaleString();
            const hashMostrado = b.hash.substring(0,19) + '...' + b.hash.slice(-25);
            output += `\n${String(b.height).padEnd(6)} ${String(b.tx_count).padEnd(3)} ${hashMostrado.padEnd(22)} ${fecha}`;
        });

        output += `\n

ULTIMAS 15 TRANSACCIONES
--------------------------------------------------------------------------------
conf monto     hash
--------------------------------------------------------------------------------`;

        data.recent.last_15_transactions.forEach(t => {
            const valor = t.value_out === null ? "0.0000" : t.value_out.toFixed(4);
            output += `\n${String(t.confirmations).padEnd(3)}  ${valor.padEnd(8)}  ${t.txid}`;
        });

        output += `\n

-----------------------------------------------------------------
MEMPOOL PREVIEW (${data.mempool.txcount} TRANSACCIONES)
-----------------------------------------------------------------`;

        if (data.recent.mempool_preview?.length) {
            data.recent.mempool_preview.forEach(item => {
                const txid = item.txid || item;
                const valor = item.value_out ? ` (${Number(item.value_out).toFixed(4)} FIRO)` : '';
                output += `\n${txid.substring(0,40)}${valor}`;
            });
        } else {
            output += `\nMempool vacío`;
        }

        output += `\n`;
        terminal.innerHTML = output;
        
    } catch (error) {
        terminal.innerHTML = `ERROR: ${error.message}`;
    }
} 

loadData();
setInterval(loadData, 45000);
</script>
</body>
</html>
