<html lang="es">
<head>
<meta charset="UTF-8">
<title>FIRO: TERMINAL</title>
<style>
body {
    background: #000;
    color: #fff;
    font-family: "Lucida Console", monospace;
    font-size: 16px;
    margin: 0;
    padding: 20px;
}
.terminal {
    max-width: 90ch;
    white-space: pre-wrap;
    line-height: 1.4;
}
.input-line {
    display: flex;
    align-items: center;
    margin: 0 0 5px 0;  
    gap: 5px;
}

#output {
    margin-top: 0;  
    padding-top: 0;
}
.prompt {
    color: #fff;
}
.cursor-input {
    background: #000;
    color: #fff;
    border: none;
    font-family: "Lucida Console", monospace;
    font-size: 15px;
    padding: 4px 0;
    width: 50ch;
    outline: none;
    caret-color: #fff;
    animation: blink 1s step-end infinite;
    autocomplete: off;
    autocorrect: off;
    autocapitalize: off;
    spellcheck: false;
}
@keyframes blink {
    from, to { caret-color: #fff; }
    50% { caret-color: transparent; }
}
.cursor-input::selection {
    background: #fff;
    color: #000;
}
.hidden-button {
    display: none;
}
.footer {
    margin-top: 40px;
    padding: 20px 0;
    color: #fff;
}
.node-line {
    margin: 10px 0;
    white-space: pre-line;
}
a, a:visited, a:hover, a:active {
    color: #9B1C2E;
    text-decoration: none; 
}
a:hover {
    text-decoration: underline; 
}

</style>
</head>
<body>

<div class="terminal">
<div id="nodeInfo" class="node-line">Cargando datos, espera antes de buscar. El proxy genera demoras a veces, recargar la pagina soluciona el problema.</div>
<div class="input-line">
    <span class="prompt">═></span>
    <input type="text" id="search" class="cursor-input" placeholder="buscar bloque/hash/txid..." autofocus autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
    <button id="searchBtn" class="hidden-button"></button></div>
<div id="output"></div>
</div>

<div class="footer">--------------------------------------------------------------------------<br>© 2026 Creada con ♥ por cΔrovΣr0 | apoya: carover0.firo</div>

<script>
let data = null;

window.handleData = function(wrapper) {
    try {
        const text = wrapper.contents;
        
        const lines = text.split('\n').filter(line => line.trim());
        data = {
            blocks: [],
            transactions: []
        };
        
        lines.forEach(line => {
            const parts = line.split('|');
            if (parts[0] === 'BLOCK') {
                data.blocks.push({
                    height: parts[1],
                    hash: parts[2],
                    time: parts[3],
                    tx_count: parts[4],
                    size: parts[5]
                });
            } else if (parts[0] === 'TX') {
                // Parsear outputs y filtrar inválidos
                let outputs = [];
                if (parts[5]) {
                    outputs = parts[5]
                        .split(';')
                        .map(str => {
                            const [vout, address, value] = str.split(':');
                            if (address && address !== 'undefined' && address !== 'null' && value && !isNaN(parseFloat(value))) {
                                return {
                                    vout: parseInt(vout),
                                    address: address,
                                    value: parseFloat(value)
                                };
                            }
                            return null;
                        })
                        .filter(o => o !== null); // Eliminar los null
                }
                
                data.transactions.push({
                    txid: parts[1],
                    block_height: parts[2],
                    value_out: parts[3] === 'null' ? null : parseFloat(parts[3]),
                    time: parts[4],
                    outputs: outputs
                });
            }
        });
        
        document.getElementById('nodeInfo').innerHTML = 
            `> BUSCAR\n> ${data.blocks.length} bloques · ${data.transactions.length} transacciones, ≈ 6h 25m atras\n\n<a href="https://carover0.github.io/pagina/explorer.html">[EXPLORADOR]</a> <a href="https://carover0.github.io/pagina/firostats.html">[FIRO]</a>`;
        
        console.log("Datos cargados:", data);
        
    } catch (e) {
        document.getElementById('nodeInfo').innerHTML = 'Error cargando datos: ' + e.message;
        console.error(e);
    }
};

function loadData() {
    const oldScript = document.getElementById('jsonp-script');
    if (oldScript) oldScript.remove();

    const script = document.createElement('script');
    script.id = 'jsonp-script';
    
    const url = "https://whateverorigin.org/get?callback=handleData&url=" + 
                encodeURIComponent("https://carover0.xyz/zfiro.txt") + 
                "&_=" + Date.now();
    
    script.src = url;
    document.body.appendChild(script);
}

function formatDate(timestamp) {
    return new Date(timestamp * 1000).toLocaleString();
}

function search() {
    if (!data) {
        document.getElementById('output').innerHTML = 'Datos no cargados aún';
        return;
    }
    
    const input = document.getElementById('search');
    const q = input.value.trim().toLowerCase();
    if (!q) return;
    
    let out = '';
    let encontrados = 0;
    
    data.blocks.forEach(b => {
        if (b.height.includes(q) || b.hash.toLowerCase().includes(q)) {
            encontrados++;
            out += `\n■ BLOQUE #${b.height}\n`;
            out += `  hash: ${b.hash}\n`;
            out += `  time: ${formatDate(b.time)}\n`;
            out += `  tx: ${b.tx_count} · size: ${b.size}b\n`;
        }
    });
    
    data.transactions.forEach(t => {
        let matchInOutputs = t.outputs?.some(o => 
            (o.address?.toLowerCase().includes(q)) || 
            (o.value?.toString().includes(q))
        ) || false;
        
        if (t.txid.toLowerCase().includes(q) || 
            (t.value_out !== null && t.value_out.toString().includes(q)) || 
            t.block_height.includes(q) ||
            matchInOutputs) {
            
            encontrados++;
            out += `\n→ TX ${t.txid}\n`;
            out += `  block: #${t.block_height}\n`;
            out += `  time: ${formatDate(t.time)}\n`;
            
            if (t.value_out !== null) {
                out += `  total: ${t.value_out.toFixed(4)} FIRO\n`;
            }
            
            if (t.outputs?.length) {
                out += `  outputs:\n`;
                t.outputs.forEach(output => {
                    if (output.address && output.address !== 'undefined' && output.address !== 'null') {
                        out += `    ${output.address} : ${output.value.toFixed(4)} FIRO\n`;
                    }
                });
            }
        }
    });    
    
    document.getElementById('output').innerHTML = 
        encontrados > 0 ? out : '> no results';
    
    input.value = '';
}

loadData();

const input = document.getElementById('search');
input.addEventListener('keypress', e => { 
    if (e.key === 'Enter') {
        search();
    }
});

window.onload = () => input.focus();
</script>

</body>
</html>
