<html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>FIRO: TERMINAL</title>
<style>
body {
    background: #000;
    color: #fff;
    font-family: "Lucida Console", monospace;
    font-size: 16px;
    margin: 0;
    padding: 20px;
}
.terminal {
    max-width: 90ch;
    white-space: pre-wrap;
    line-height: 1.4;
}
.input-line {
    display: flex;
    align-items: center;
    margin: 15px 0;
    gap: 5px;
}
.prompt {
    color: #fff;
}
.cursor-input {
    background: #000;
    color: #fff;
    border: none;
    font-family: "Lucida Console", monospace;
    font-size: 15px;
    padding: 4px 0;
    width: 50ch;
    outline: none;
    caret-color: #fff;
    animation: blink 1s step-end infinite;
    autocomplete: off;
    autocorrect: off;
    autocapitalize: off;
    spellcheck: false;
}
@keyframes blink {
    from, to { caret-color: #fff; }
    50% { caret-color: transparent; }
}
.cursor-input::selection {
    background: #fff;
    color: #000;
}
.hidden-button {
    display: none;
}
.footer {
    margin-top: 40px;
    padding: 20px 0;
    color: #fff;
}
.node-line {
    margin: 10px 0;
    white-space: pre-line;
}
a, a:visited, a:hover, a:active {
    color: #9B1C2E;
    text-decoration: none; 
}
a:hover {
    text-decoration: underline; 
}

</style>
</head>
<body>

<div class="terminal">
<div id="nodeInfo" class="node-line">> cargando datos, espera antes de buscar...</div>
<div class="input-line">
    <span class="prompt">></span>
    <input type="text" id="search" class="cursor-input" placeholder="buscar bloque/hash/txid..." autofocus autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
    <button id="searchBtn" class="hidden-button"></button>
</div>

<div id="output"></div>
</div>

<div class="footer">--------------------------------------------------------------------------<br>© 2026 Creada con ♥ por cΔrovΣr0 | apoya: carover0.firo</div>

<script>
let data = null;

window.handleData = function(wrapper) {
    try {
        // El contenido está en wrapper.contents
        const text = wrapper.contents;
        
        // Parsear el formato: tipo|datos...
        const lines = text.split('\n').filter(line => line.trim());
        data = {
            blocks: [],
            transactions: []
        };
        
        lines.forEach(line => {
            const parts = line.split('|');
            if (parts[0] === 'BLOCK') {
                data.blocks.push({
                    height: parts[1],
                    hash: parts[2],
                    time: parts[3],
                    tx_count: parts[4],
                    size: parts[5]
                });
            } else if (parts[0] === 'TX') {
                data.transactions.push({
                    txid: parts[1],
                    block_height: parts[2],
                    value_out: parts[3],
                    time: parts[4]
                });
            }
        });
        
        document.getElementById('nodeInfo').innerHTML = 
            `> FIRO SEARCH\n> ${data.blocks.length} bloques · ${data.transactions.length} transacciones\n\n<a href="https://carover0.github.io/pagina/explorer.html">[EXPLORADOR]</a> <a href="https://carover0.github.io/pagina/firostats.html">[FIRO]</a>
 `;
        
        console.log("Datos cargados:", data);
        
    } catch (e) {
        document.getElementById('nodeInfo').innerHTML = '> error cargando datos: ' + e.message;
        console.error(e);
    }
};

function loadData() {
    const oldScript = document.getElementById('jsonp-script');
    if (oldScript) oldScript.remove();

    const script = document.createElement('script');
    script.id = 'jsonp-script';
    
    const url = "https://whateverorigin.org/get?callback=handleData&url=" + 
                encodeURIComponent("https://carover0.xyz/zfiro.txt") + 
                "&_=" + Date.now();
    
    script.src = url;
    document.body.appendChild(script);
}

function formatDate(timestamp) {
    return new Date(timestamp * 1000).toLocaleString();
}

function search() {
    if (!data) {
        document.getElementById('output').innerHTML = '> datos no cargados aún';
        return;
    }
    
    const input = document.getElementById('search');
    const q = input.value.trim().toLowerCase();
    if (!q) return;
    
    let out = '';
    let encontrados = 0;
    
    data.blocks.forEach(b => {
        if (b.height.includes(q) || b.hash.toLowerCase().includes(q)) {
            encontrados++;
            out += `\n> BLOQUE #${b.height}\n`;
            out += `  hash: ${b.hash}\n`;
            out += `  time: ${formatDate(b.time)}\n`;
            out += `  tx: ${b.tx_count} · size: ${b.size}b\n`;
        }
    });
    
    data.transactions.forEach(t => {
        if (t.txid.toLowerCase().includes(q) || 
            t.value_out.includes(q) || 
            t.block_height.includes(q)) {
            encontrados++;
            out += `\n> TX ${t.txid}\n`;
            out += `  block: #${t.block_height}\n`;
            out += `  value: ${parseFloat(t.value_out).toFixed(4)} FIRO\n`;
            out += `  time: ${formatDate(t.time)}\n`;
        }
    });
    
    document.getElementById('output').innerHTML = 
        encontrados > 0 ? out : '> no results';
    
    input.value = '';
}

loadData();

const input = document.getElementById('search');
input.addEventListener('keypress', e => { 
    if (e.key === 'Enter') {
        search();
    }
});

window.onload = () => input.focus();
</script>

</body>
</html>
